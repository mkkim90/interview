# 시스템 설계 및 규모 확장성

## 시스템 설계의 핵심 개념

### 수평적(horizontal) vs 수직적(vertical) 규모 확장

- 수직적 규모 확장(vertical scaling) : 특정 노드의 자원의 양을 늘리는 방법을 의미합니다. 예를 들어서 서버에 메모리를 추가해서 서버의 처리 능력을 향상시킬수 있습니다. 
- 수평적 규모 확장(horizontal scaling) : 노드의 개수를 늘리는 방법을 의미합니다. 서버를 추가함으로써 서버 한대가 다뤄야 하는 부하를 줄일 수 있습니다. 

### 서버 부하 분산 장치(로드밸런서)

서버에 걸리는 부하를 여러 대의 서버에 균일하게 분산 시킬 수 있고 서버 한 대 때문에 전체 시스템이 죽거나 다운되는 상황을 방지할 수 있습니다. 
물론 이렇게 하기 위해선 서버 여러 대가 근본적으로 똑같은 코드와 데이터를 사용하도록 하는 네트워크를 구현해놔야합니다. 

### 데이터베이스 역정규화와 nosql 

SQL 같은 관계형 데이터베이스의 조인 연산은 시스템이 커질수록 느려집니다. 따라서 조인 연산은 가능하면 피해햐 합니다. 

역정규화란 데이터베이스에 여분의 정보를 추가해서 읽기 연산 속도를 향상 시킨 것을 의미합니다. 
예를 들어, 한 프로젝트가 여러 과제를 수행하도록 설계된 데이터베이스를 생각해보자. 이 데이터 베이스에서 프로젝트 이름이랑 과제 정보를 
함께 알고 싶은 경우에 두 테이블을 조인하기보단 애초에 과제 테이블에 프로젝트 이름 정보를 추가로 저장해 놓으면 더 빠르게 작업을 수행할 수 있습니다. 

NoSQL 데이터베이스를 사용할 수도 있습니다. NoSQL은 조인 연산 자체를 지원하지 않습니다. 자료를 저장할 때 조금 다른 방식으로 구성해 놓는데, 이 방식이 규모 확장성에 좋도록 설계되어있습니다.


### 데이터베이스 분할 (샤딩)

샤딩은 데이터를 여러 컴퓨터에 나눠서 저장하는 동시에 어떤 데이터가 어떤 컴퓨터에 저장되어 있는지 알 수 있는 방식을 말합니다. 

- 수직적 분할 (vertical partitioning) 
기본적으로 자료의 특성별로 분할하는 방식을 말합니다. 

- 키 혹은 해시 분할 
이 방법을 아주 간단하게 구현하면 mod(key, n)의 값을 이용해서 N개의 서버에 분할 저장하면 됩니다. 
한가지 문제점은 서버의 개수가 사실상 고정되어 있어야 한다는 점입니다. 서버를 새로 추가할 때마다 모든 데이터를 다시 재분배해야 하는데, 굉장히 비용이 큰 작업입니다. 

- 디렉토리 기반 분할
조회 테이블을 유지하는 방법입니다. 
이 방법이 상대적으로 서버를 추가하기 쉽지만 두가지 단점이 있습니다.
1. 조회테이블이 단일 장애 지점이 될 수 있습니다.
2. 지속적으로 데이터를 읽는 행위가 전체 성능에 영향을 미칠 수 있습니다. 

### 캐싱
인메모리 캐시를 사용하면 결과를 굉장히 빠르게 가져올 수 있습니다. 인메모리 캐시는 키-값을 쌍으로 갖는 간단한 구조로써, 일반적으로 애플리케이션과 데이터 저장소 사이에 자리잡고 있습니다. 

애플리케이션이 어떤 자료를 요청하면 캐시를 먼저 확인합니다.
캐시가 해당 키 값을 갖고 있지 않으면 그때 데이터 저장소를 살펴봅니다.

### 비동기식 처리 & 큐

이상적이라면, 속도가 느린 연산은 비동기식으로 처리해야합니다.
그렇지 않으면 해당 연산이 끝나기까지 하염없이 기다려야 할 수도 있기 때문입니다.

### 네트워크 성능 척도

대역폭(bandwidth) : 단위 시간에 전송할 수 있는 데이터의 최대치
처리량(throughput) :  처리량은 단위 시간에 실제로 전송된 데이터의 양
지연속도(latency) : 데이터를 전송하는 데 걸리는 시간

### 시스템 설계 시 고려할 점

- 실패 (failover) : 시스템의 어떤 부분이든 실패 가능성이 존재합니다. 따라서 각 부분이 실패했을 때를 대비한 대비책을 준비해야합니다.
- 가용성(availability) 및 신뢰성(reliability) : 가용성은 사용 가능한 시스템의 시간을 백분율. 신뢰성은 특정 단위 시간에 시스템이 사용 가능할 확률.
- 읽기 중심 vs 쓰기 중심 : 읽는 연산이 많은지 아니면 쓰는 연산이 많은지에 따라 설계 방식이 달라질 수 있습니다. 쓰는 연산이 많다면, 큐를 사용하는 방법을 한번 생각해보라. 읽는 연산이 많다면 캐시를 사용하는 것이 좋을 수도 있습니다.
- 보안 
